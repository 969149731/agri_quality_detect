<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.out.mapper.outVegFruInventoryMapper">
    <cache type="com.ruoyi.common.core.redis.MybatisRedisCache" eviction="LRU"/>
    
    <resultMap type="outVegFruInventory" id="outVegFruInventoryResult">
        <result property="vegFruInventoryId"    column="veg_fru_inventory_id"    />
        <result property="vegetableSeqNo"    column="vegetable_seq_no"    />
        <result property="vegetableDetailName"    column="vegetable_detail_name"    />
        <result property="vegetableQuantity"    column="vegetable_quantity"    />
        <result property="fruitSeqNo"    column="fruit_seq_no"    />
        <result property="fruitDetailName"    column="fruit__detail_name"    />
        <result property="fruitQuantity"    column="fruit_quantity"    />
        <result property="createdDate"    column="created_date"    />
    </resultMap>

    <sql id="selectoutVegFruInventoryVo">
        select veg_fru_inventory_id, vegetable_seq_no, vegetable_detail_name, vegetable_quantity, fruit_seq_no, fruit__detail_name, fruit_quantity, created_date from out_veg_fru_inventory
    </sql>

    <select id="selectoutVegFruInventoryList" parameterType="outVegFruInventory" resultMap="outVegFruInventoryResult">
        <include refid="selectoutVegFruInventoryVo"/>
        <where>  
            <if test="vegetableSeqNo != null "> and vegetable_seq_no = #{vegetableSeqNo}</if>
            <if test="vegetableDetailName != null  and vegetableDetailName != ''"> and vegetable_detail_name like concat('%', #{vegetableDetailName}, '%')</if>
            <if test="vegetableQuantity != null "> and vegetable_quantity = #{vegetableQuantity}</if>
            <if test="fruitSeqNo != null "> and fruit_seq_no = #{fruitSeqNo}</if>
            <if test="fruitDetailName != null  and fruitDetailName != ''"> and fruit__detail_name like concat('%', #{fruitDetailName}, '%')</if>
            <if test="fruitQuantity != null "> and fruit_quantity = #{fruitQuantity}</if>
            <if test="createdDate != null "> and created_date = #{createdDate}</if>
        </where>
    </select>
    
    <select id="selectoutVegFruInventoryByVegFruInventoryId" parameterType="Long" resultMap="outVegFruInventoryResult">
        <include refid="selectoutVegFruInventoryVo"/>
        where veg_fru_inventory_id = #{vegFruInventoryId}
    </select>
        
    <insert id="insertoutVegFruInventory" parameterType="outVegFruInventory" useGeneratedKeys="true" keyProperty="vegFruInventoryId">
        insert into out_veg_fru_inventory
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="vegetableSeqNo != null">vegetable_seq_no,</if>
            <if test="vegetableDetailName != null">vegetable_detail_name,</if>
            <if test="vegetableQuantity != null">vegetable_quantity,</if>
            <if test="fruitSeqNo != null">fruit_seq_no,</if>
            <if test="fruitDetailName != null">fruit__detail_name,</if>
            <if test="fruitQuantity != null">fruit_quantity,</if>
            <if test="createdDate != null">created_date,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="vegetableSeqNo != null">#{vegetableSeqNo},</if>
            <if test="vegetableDetailName != null">#{vegetableDetailName},</if>
            <if test="vegetableQuantity != null">#{vegetableQuantity},</if>
            <if test="fruitSeqNo != null">#{fruitSeqNo},</if>
            <if test="fruitDetailName != null">#{fruitDetailName},</if>
            <if test="fruitQuantity != null">#{fruitQuantity},</if>
            <if test="createdDate != null">#{createdDate},</if>
         </trim>
    </insert>

    <update id="updateoutVegFruInventory" parameterType="outVegFruInventory">
        update out_veg_fru_inventory
        <trim prefix="SET" suffixOverrides=",">
            <if test="vegetableSeqNo != null">vegetable_seq_no = #{vegetableSeqNo},</if>
            <if test="vegetableDetailName != null">vegetable_detail_name = #{vegetableDetailName},</if>
            <if test="vegetableQuantity != null">vegetable_quantity = #{vegetableQuantity},</if>
            <if test="fruitSeqNo != null">fruit_seq_no = #{fruitSeqNo},</if>
            <if test="fruitDetailName != null">fruit__detail_name = #{fruitDetailName},</if>
            <if test="fruitQuantity != null">fruit_quantity = #{fruitQuantity},</if>
            <if test="createdDate != null">created_date = #{createdDate},</if>
        </trim>
        where veg_fru_inventory_id = #{vegFruInventoryId}
    </update>

    <delete id="deleteoutVegFruInventoryByVegFruInventoryId" parameterType="Long">
        delete from out_veg_fru_inventory where veg_fru_inventory_id = #{vegFruInventoryId}
    </delete>

    <delete id="deleteoutVegFruInventoryByVegFruInventoryIds" parameterType="String">
        delete from out_veg_fru_inventory where veg_fru_inventory_id in 
        <foreach item="vegFruInventoryId" collection="array" open="(" separator="," close=")">
            #{vegFruInventoryId}
        </foreach>
    </delete>

    <resultMap id="VegFruStatisticMap" type="VegFruStatistic">
        <result property="name" column="NAME"/>
        <result property="type" column="TYPE"/>
        <result property="quantity" column="Quantity"/>
    </resultMap>

<!--   没有加时间搜索的 <select id="selectVegFruStatistic" resultMap="VegFruStatisticMap">-->
<!--        SELECT-->
<!--            avf.veg_fru_name AS NAME,-->
<!--            '蔬菜' AS TYPE,-->
<!--            COUNT(acstd.city_sample_test_details_id) AS Quantity-->
<!--        FROM-->
<!--            agri_city_sample_test_details acstd-->
<!--                JOIN-->
<!--            agri_vegetable_fruit avf ON acstd.veg_fru_name = avf.veg_fru_name-->
<!--        WHERE-->
<!--            avf.veg_fru_type = '蔬菜'-->
<!--        GROUP BY-->
<!--            avf.veg_fru_name-->

<!--        UNION ALL-->

<!--        SELECT-->
<!--            avf.veg_fru_name AS NAME,-->
<!--            '水果' AS TYPE,-->
<!--            COUNT(acstd.city_sample_test_details_id) AS Quantity-->
<!--        FROM-->
<!--            agri_city_sample_test_details acstd-->
<!--                JOIN-->
<!--            agri_vegetable_fruit avf ON acstd.veg_fru_name = avf.veg_fru_name-->
<!--        WHERE-->
<!--            avf.veg_fru_type = '水果'-->
<!--        GROUP BY-->
<!--            avf.veg_fru_name-->
<!--    </select>-->


    <select id="selectVegFruStatistic" resultMap="VegFruStatisticMap">
        SELECT
        avf.veg_fru_name AS NAME,
        '蔬菜' AS TYPE,
        COUNT(acstd.city_sample_test_details_id) AS Quantity
        FROM
        agri_city_sample_test_details acstd
        JOIN
        agri_vegetable_fruit avf ON acstd.veg_fru_name = avf.veg_fru_name
        where
        avf.veg_fru_type = '蔬菜'

<!--        <if test="samplingLocationProvince != null  and samplingLocationProvince != ''"> and acstd.sampling_location_province = #{samplingLocationProvince}</if>-->
<!--        <if test="samplingLocationCity != null  and samplingLocationCity != ''"> and acstd.sampling_location_city = #{samplingLocationCity}</if>-->
<!--        <if test="samplingLocationCounty != null  and samplingLocationCounty != ''"> and acstd.sampling_location_county = #{samplingLocationCounty}</if>-->
<!--        <if test="enterpriseAttribute != null  and enterpriseAttribute != ''"> and acstd.enterprise_attribute = #{enterpriseAttribute}</if>-->
<!--        <if test="enterpriseCreditIdCode != null  and enterpriseCreditIdCode != ''"> and acstd.enterprise_credit_id_code = #{enterpriseCreditIdCode}</if>-->
<!--        <if test="tracingProvince != null  and tracingProvince != ''"> and acstd.tracing_province = #{tracingProvince}</if>-->
<!--        <if test="tracingCity != null  and tracingCity != ''"> and acstd.tracing_city = #{tracingCity}</if>-->
<!--        <if test="tracingCounty != null  and tracingCounty != ''"> and acstd.tracing_county = #{tracingCounty}</if>-->
<!--        <if test="tracingArea != null  and tracingArea != ''"> and acstd.tracing_area = #{tracingArea}</if>-->



        <if test="sampleCode != null  and sampleCode != ''"> and sample_code = #{sampleCode}</if>
        <if test="vegFruName != null  and vegFruName != ''"> and veg_fru_name like concat('%', #{vegFruName}, '%')</if>
        <!--            <if test="samplingLocation != null  and samplingLocation != ''"> and sampling_location = #{samplingLocation}</if>-->
        <if test="samplingLocation != null  and samplingLocation != ''"> and sampling_location like concat('%', #{samplingLocation}, '%')</if>
        <!--            <if test="detectLocation != null  and detectLocation != ''"> and detect_location = #{detectLocation}</if>-->
        <if test="detectLocation != null  and detectLocation != ''"> and detect_location like concat('%', #{detectLocation}, '%')</if>
        <if test="samplingStageType != null  and samplingStageType != ''"> and sampling_stage_type like concat('%', #{samplingStageType}, '%')</if>
        <if test="samplingDate != null "> and sampling_date = #{samplingDate}</if>
        <if test="chinaStandard != null  and chinaStandard != ''"> and china_standard = #{chinaStandard}</if>
        <if test="cacStandard != null  and cacStandard != ''"> and cac_standard = #{cacStandard}</if>
        <if test="japanStandard != null  and japanStandard != ''"> and japan_standard = #{japanStandard}</if>
        <if test="euStandard != null  and euStandard != ''"> and eu_standard = #{euStandard}</if>
        <if test="usStandard != null  and usStandard != ''"> and us_standard = #{usStandard}</if>
        <if test="koreaStandard != null  and koreaStandard != ''"> and korea_standard = #{koreaStandard}</if>

        <if test="samplingLocationProvince != null  and samplingLocationProvince != ''"> and sampling_location_province = #{samplingLocationProvince}</if>
        <if test="samplingLocationCity != null  and samplingLocationCity != ''"> and sampling_location_city = #{samplingLocationCity}</if>
        <if test="samplingLocationCounty != null  and samplingLocationCounty != ''"> and sampling_location_county = #{samplingLocationCounty}</if>
        <if test="enterpriseAttribute != null  and enterpriseAttribute != ''"> and enterprise_attribute = #{enterpriseAttribute}</if>
        <if test="enterpriseName != null  and enterpriseName != ''"> and enterprise_name = #{enterpriseName}</if>


        <if test="enterpriseCreditIdCode != null  and enterpriseCreditIdCode != ''"> and enterprise_credit_id_code = #{enterpriseCreditIdCode}</if>
        <if test="tracingProvince != null  and tracingProvince != ''"> and tracing_province = #{tracingProvince}</if>
        <if test="tracingCity != null  and tracingCity != ''"> and tracing_city = #{tracingCity}</if>
        <if test="tracingCounty != null  and tracingCounty != ''"> and tracing_county = #{tracingCounty}</if>
        <if test="tracingArea != null  and tracingArea != ''"> and tracing_area = #{tracingArea}</if>

        <if test="vegFruType != null  and vegFruType != ''"> and veg_fru_type = #{vegFruType}</if>






        <if test="params.beginTime != null and params.beginTime != ''">
                AND date_format(acstd.sampling_date,'%y%m%d') &gt;= date_format(#{params.beginTime},'%y%m%d')
            </if>
            <if test="params.endTime != null and params.endTime != ''">
                AND date_format(acstd.sampling_date,'%y%m%d') &lt;= date_format(#{params.endTime},'%y%m%d')
            </if>

        GROUP BY
        avf.veg_fru_name

        UNION ALL

        SELECT
        avf.veg_fru_name AS NAME,
        '水果' AS TYPE,
        COUNT(acstd.city_sample_test_details_id) AS Quantity
        FROM
        agri_city_sample_test_details acstd
        JOIN
        agri_vegetable_fruit avf ON acstd.veg_fru_name = avf.veg_fru_name
        WHERE
        avf.veg_fru_type = '水果'

<!--        <if test="samplingLocationProvince != null  and samplingLocationProvince != ''"> and acstd.sampling_location_province = #{samplingLocationProvince}</if>-->
<!--        <if test="samplingLocationCity != null  and samplingLocationCity != ''"> and acstd.sampling_location_city = #{samplingLocationCity}</if>-->
<!--        <if test="samplingLocationCounty != null  and samplingLocationCounty != ''"> and acstd.sampling_location_county = #{samplingLocationCounty}</if>-->
<!--        <if test="enterpriseAttribute != null  and enterpriseAttribute != ''"> and acstd.enterprise_attribute = #{enterpriseAttribute}</if>-->
<!--        <if test="enterpriseCreditIdCode != null  and enterpriseCreditIdCode != ''"> and acstd.enterprise_credit_id_code = #{enterpriseCreditIdCode}</if>-->
<!--        <if test="tracingProvince != null  and tracingProvince != ''"> and acstd.tracing_province = #{tracingProvince}</if>-->
<!--        <if test="tracingCity != null  and tracingCity != ''"> and acstd.tracing_city = #{tracingCity}</if>-->
<!--        <if test="tracingCounty != null  and tracingCounty != ''"> and acstd.tracing_county = #{tracingCounty}</if>-->
<!--        <if test="tracingArea != null  and tracingArea != ''"> and acstd.tracing_area = #{tracingArea}</if>-->

        <if test="sampleCode != null  and sampleCode != ''"> and sample_code = #{sampleCode}</if>
        <if test="vegFruName != null  and vegFruName != ''"> and veg_fru_name like concat('%', #{vegFruName}, '%')</if>
        <!--            <if test="samplingLocation != null  and samplingLocation != ''"> and sampling_location = #{samplingLocation}</if>-->
        <if test="samplingLocation != null  and samplingLocation != ''"> and sampling_location like concat('%', #{samplingLocation}, '%')</if>
        <!--            <if test="detectLocation != null  and detectLocation != ''"> and detect_location = #{detectLocation}</if>-->
        <if test="detectLocation != null  and detectLocation != ''"> and detect_location like concat('%', #{detectLocation}, '%')</if>
        <if test="samplingStageType != null  and samplingStageType != ''"> and sampling_stage_type like concat('%', #{samplingStageType}, '%')</if>
        <if test="samplingDate != null "> and sampling_date = #{samplingDate}</if>
        <if test="chinaStandard != null  and chinaStandard != ''"> and china_standard = #{chinaStandard}</if>
        <if test="cacStandard != null  and cacStandard != ''"> and cac_standard = #{cacStandard}</if>
        <if test="japanStandard != null  and japanStandard != ''"> and japan_standard = #{japanStandard}</if>
        <if test="euStandard != null  and euStandard != ''"> and eu_standard = #{euStandard}</if>
        <if test="usStandard != null  and usStandard != ''"> and us_standard = #{usStandard}</if>
        <if test="koreaStandard != null  and koreaStandard != ''"> and korea_standard = #{koreaStandard}</if>

        <if test="samplingLocationProvince != null  and samplingLocationProvince != ''"> and sampling_location_province = #{samplingLocationProvince}</if>
        <if test="samplingLocationCity != null  and samplingLocationCity != ''"> and sampling_location_city = #{samplingLocationCity}</if>
        <if test="samplingLocationCounty != null  and samplingLocationCounty != ''"> and sampling_location_county = #{samplingLocationCounty}</if>
        <if test="enterpriseAttribute != null  and enterpriseAttribute != ''"> and enterprise_attribute = #{enterpriseAttribute}</if>
        <if test="enterpriseName != null  and enterpriseName != ''"> and enterprise_name = #{enterpriseName}</if>


        <if test="enterpriseCreditIdCode != null  and enterpriseCreditIdCode != ''"> and enterprise_credit_id_code = #{enterpriseCreditIdCode}</if>
        <if test="tracingProvince != null  and tracingProvince != ''"> and tracing_province = #{tracingProvince}</if>
        <if test="tracingCity != null  and tracingCity != ''"> and tracing_city = #{tracingCity}</if>
        <if test="tracingCounty != null  and tracingCounty != ''"> and tracing_county = #{tracingCounty}</if>
        <if test="tracingArea != null  and tracingArea != ''"> and tracing_area = #{tracingArea}</if>

        <if test="vegFruType != null  and vegFruType != ''"> and veg_fru_type = #{vegFruType}</if>



        <if test="params.beginTime != null and params.beginTime != ''">
            AND date_format(acstd.sampling_date,'%y%m%d') &gt;= date_format(#{params.beginTime},'%y%m%d')
        </if>
        <if test="params.endTime != null and params.endTime != ''">
            AND date_format(acstd.sampling_date,'%y%m%d') &lt;= date_format(#{params.endTime},'%y%m%d')
        </if>
        GROUP BY
        avf.veg_fru_name



        UNION ALL
        SELECT
        avf.veg_fru_name AS NAME,
        '茶叶' AS TYPE,
        COUNT(acstd.city_sample_test_details_id) AS Quantity
        FROM
        agri_city_sample_test_details acstd
        JOIN
        agri_vegetable_fruit avf ON acstd.veg_fru_name = avf.veg_fru_name
        WHERE
        avf.veg_fru_type = '茶叶'

<!--        <if test="samplingLocationProvince != null  and samplingLocationProvince != ''"> and acstd.sampling_location_province = #{samplingLocationProvince}</if>-->
<!--        <if test="samplingLocationCity != null  and samplingLocationCity != ''"> and acstd.sampling_location_city = #{samplingLocationCity}</if>-->
<!--        <if test="samplingLocationCounty != null  and samplingLocationCounty != ''"> and acstd.sampling_location_county = #{samplingLocationCounty}</if>-->
<!--        <if test="enterpriseAttribute != null  and enterpriseAttribute != ''"> and acstd.enterprise_attribute = #{enterpriseAttribute}</if>-->
<!--        <if test="enterpriseCreditIdCode != null  and enterpriseCreditIdCode != ''"> and acstd.enterprise_credit_id_code = #{enterpriseCreditIdCode}</if>-->
<!--        <if test="tracingProvince != null  and tracingProvince != ''"> and acstd.tracing_province = #{tracingProvince}</if>-->
<!--        <if test="tracingCity != null  and tracingCity != ''"> and acstd.tracing_city = #{tracingCity}</if>-->
<!--        <if test="tracingCounty != null  and tracingCounty != ''"> and acstd.tracing_county = #{tracingCounty}</if>-->
<!--        <if test="tracingArea != null  and tracingArea != ''"> and acstd.tracing_area = #{tracingArea}</if>-->


        <if test="sampleCode != null  and sampleCode != ''"> and sample_code = #{sampleCode}</if>
        <if test="vegFruName != null  and vegFruName != ''"> and veg_fru_name like concat('%', #{vegFruName}, '%')</if>
        <!--            <if test="samplingLocation != null  and samplingLocation != ''"> and sampling_location = #{samplingLocation}</if>-->
        <if test="samplingLocation != null  and samplingLocation != ''"> and sampling_location like concat('%', #{samplingLocation}, '%')</if>
        <!--            <if test="detectLocation != null  and detectLocation != ''"> and detect_location = #{detectLocation}</if>-->
        <if test="detectLocation != null  and detectLocation != ''"> and detect_location like concat('%', #{detectLocation}, '%')</if>
        <if test="samplingStageType != null  and samplingStageType != ''"> and sampling_stage_type like concat('%', #{samplingStageType}, '%')</if>
        <if test="samplingDate != null "> and sampling_date = #{samplingDate}</if>
        <if test="chinaStandard != null  and chinaStandard != ''"> and china_standard = #{chinaStandard}</if>
        <if test="cacStandard != null  and cacStandard != ''"> and cac_standard = #{cacStandard}</if>
        <if test="japanStandard != null  and japanStandard != ''"> and japan_standard = #{japanStandard}</if>
        <if test="euStandard != null  and euStandard != ''"> and eu_standard = #{euStandard}</if>
        <if test="usStandard != null  and usStandard != ''"> and us_standard = #{usStandard}</if>
        <if test="koreaStandard != null  and koreaStandard != ''"> and korea_standard = #{koreaStandard}</if>

        <if test="samplingLocationProvince != null  and samplingLocationProvince != ''"> and sampling_location_province = #{samplingLocationProvince}</if>
        <if test="samplingLocationCity != null  and samplingLocationCity != ''"> and sampling_location_city = #{samplingLocationCity}</if>
        <if test="samplingLocationCounty != null  and samplingLocationCounty != ''"> and sampling_location_county = #{samplingLocationCounty}</if>
        <if test="enterpriseAttribute != null  and enterpriseAttribute != ''"> and enterprise_attribute = #{enterpriseAttribute}</if>
        <if test="enterpriseName != null  and enterpriseName != ''"> and enterprise_name = #{enterpriseName}</if>


        <if test="enterpriseCreditIdCode != null  and enterpriseCreditIdCode != ''"> and enterprise_credit_id_code = #{enterpriseCreditIdCode}</if>
        <if test="tracingProvince != null  and tracingProvince != ''"> and tracing_province = #{tracingProvince}</if>
        <if test="tracingCity != null  and tracingCity != ''"> and tracing_city = #{tracingCity}</if>
        <if test="tracingCounty != null  and tracingCounty != ''"> and tracing_county = #{tracingCounty}</if>
        <if test="tracingArea != null  and tracingArea != ''"> and tracing_area = #{tracingArea}</if>

        <if test="vegFruType != null  and vegFruType != ''"> and veg_fru_type = #{vegFruType}</if>



        <if test="params.beginTime != null and params.beginTime != ''">
            AND date_format(acstd.sampling_date,'%y%m%d') &gt;= date_format(#{params.beginTime},'%y%m%d')
        </if>
        <if test="params.endTime != null and params.endTime != ''">
            AND date_format(acstd.sampling_date,'%y%m%d') &lt;= date_format(#{params.endTime},'%y%m%d')
        </if>
        GROUP BY
        avf.veg_fru_name

    </select>


    <select id="selectVegDetailTypeInventory" resultType="OutDetailTypeInventoryVo">
        SELECT
        COALESCE(IF(TRIM(af.`detail_type`) = '', '蔬菜其它类', af.`detail_type`), '蔬菜其它类') AS `detail_type`,
        COUNT(acstd.`city_sample_test_details_id`) AS `sample_count`
        FROM `agri_city_sample_test_details` acstd
        JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`
        <where>
            <if test="vegFruType != null and vegFruType != ''">
                af.`veg_fru_type` = #{vegFruType}
            </if>

            <if test="agriCitySampleTestDetails.sampleCode != null and agriCitySampleTestDetails.sampleCode != ''">
                AND sample_code = #{agriCitySampleTestDetails.sampleCode}
            </if>
            <if test="agriCitySampleTestDetails.vegFruName != null and agriCitySampleTestDetails.vegFruName != ''">
                AND veg_fru_name LIKE concat('%', #{agriCitySampleTestDetails.vegFruName}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingLocation != null and agriCitySampleTestDetails.samplingLocation != ''">
                AND sampling_location LIKE concat('%', #{agriCitySampleTestDetails.samplingLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.detectLocation != null and agriCitySampleTestDetails.detectLocation != ''">
                AND detect_location LIKE concat('%', #{agriCitySampleTestDetails.detectLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingStageType != null and agriCitySampleTestDetails.samplingStageType != ''">
                AND sampling_stage_type LIKE concat('%', #{agriCitySampleTestDetails.samplingStageType}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingDate != null">
                AND sampling_date = #{agriCitySampleTestDetails.samplingDate}
            </if>
            <if test="agriCitySampleTestDetails.chinaStandard != null and agriCitySampleTestDetails.chinaStandard != ''">
                AND china_standard = #{agriCitySampleTestDetails.chinaStandard}
            </if>
            <if test="agriCitySampleTestDetails.cacStandard != null and agriCitySampleTestDetails.cacStandard != ''">
                AND cac_standard = #{agriCitySampleTestDetails.cacStandard}
            </if>
            <if test="agriCitySampleTestDetails.japanStandard != null and agriCitySampleTestDetails.japanStandard != ''">
                AND japan_standard = #{agriCitySampleTestDetails.japanStandard}
            </if>
            <if test="agriCitySampleTestDetails.euStandard != null and agriCitySampleTestDetails.euStandard != ''">
                AND eu_standard = #{agriCitySampleTestDetails.euStandard}
            </if>
            <if test="agriCitySampleTestDetails.usStandard != null and agriCitySampleTestDetails.usStandard != ''">
                AND us_standard = #{agriCitySampleTestDetails.usStandard}
            </if>
            <if test="agriCitySampleTestDetails.koreaStandard != null and agriCitySampleTestDetails.koreaStandard != ''">
                AND korea_standard = #{agriCitySampleTestDetails.koreaStandard}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationProvince != null and agriCitySampleTestDetails.samplingLocationProvince != ''">
                AND sampling_location_province = #{agriCitySampleTestDetails.samplingLocationProvince}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCity != null and agriCitySampleTestDetails.samplingLocationCity != ''">
                AND sampling_location_city = #{agriCitySampleTestDetails.samplingLocationCity}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCounty != null and agriCitySampleTestDetails.samplingLocationCounty != ''">
                AND sampling_location_county = #{agriCitySampleTestDetails.samplingLocationCounty}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseAttribute != null and agriCitySampleTestDetails.enterpriseAttribute != ''">
                AND enterprise_attribute = #{agriCitySampleTestDetails.enterpriseAttribute}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseName != null and agriCitySampleTestDetails.enterpriseName != ''">
                AND enterprise_name = #{agriCitySampleTestDetails.enterpriseName}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseCreditIdCode != null and agriCitySampleTestDetails.enterpriseCreditIdCode != ''">
                AND enterprise_credit_id_code = #{agriCitySampleTestDetails.enterpriseCreditIdCode}
            </if>
            <if test="agriCitySampleTestDetails.tracingProvince != null and agriCitySampleTestDetails.tracingProvince != ''">
                AND tracing_province = #{agriCitySampleTestDetails.tracingProvince}
            </if>
            <if test="agriCitySampleTestDetails.tracingCity != null and agriCitySampleTestDetails.tracingCity != ''">
                AND tracing_city = #{agriCitySampleTestDetails.tracingCity}
            </if>
            <if test="agriCitySampleTestDetails.tracingCounty != null and agriCitySampleTestDetails.tracingCounty != ''">
                AND tracing_county = #{agriCitySampleTestDetails.tracingCounty}
            </if>
            <if test="agriCitySampleTestDetails.tracingArea != null and agriCitySampleTestDetails.tracingArea != ''">
                AND tracing_area = #{agriCitySampleTestDetails.tracingArea}
            </if>
            <if test="agriCitySampleTestDetails.userName != null and agriCitySampleTestDetails.userName != ''">
                AND user_name = #{agriCitySampleTestDetails.userName}
            </if>
            <if test="agriCitySampleTestDetails.params.beginTime != null and agriCitySampleTestDetails.params.beginTime != ''"><!-- 开始时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &gt;= date_format(#{agriCitySampleTestDetails.params.beginTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.params.endTime != null and agriCitySampleTestDetails.params.endTime != ''"><!-- 结束时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &lt;= date_format(#{agriCitySampleTestDetails.params.endTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.samplingType != null and agriCitySampleTestDetails.samplingType != ''">
                AND sampling_type = #{agriCitySampleTestDetails.samplingType}
            </if>




        </where>
        GROUP BY COALESCE(IF(TRIM(af.`detail_type`) = '', '蔬菜其它类', af.`detail_type`), '蔬菜其它类')
        ORDER BY `sample_count` DESC
    </select>




    <select id="selectFruDetailTypeInventory" resultType="OutDetailTypeInventoryVo">
        SELECT
        COALESCE(IF(TRIM(af.`detail_type`) = '', '水果其它类', af.`detail_type`), '水果其它类') AS `detail_type`,
        COUNT(acstd.`city_sample_test_details_id`) AS `sample_count`
        FROM `agri_city_sample_test_details` acstd
        JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`
        <where>
            <if test="vegFruType != null and vegFruType != ''">
                af.`veg_fru_type` = #{vegFruType}
            </if>

            <if test="agriCitySampleTestDetails.sampleCode != null and agriCitySampleTestDetails.sampleCode != ''">
                AND sample_code = #{agriCitySampleTestDetails.sampleCode}
            </if>
            <if test="agriCitySampleTestDetails.vegFruName != null and agriCitySampleTestDetails.vegFruName != ''">
                AND veg_fru_name LIKE concat('%', #{agriCitySampleTestDetails.vegFruName}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingLocation != null and agriCitySampleTestDetails.samplingLocation != ''">
                AND sampling_location LIKE concat('%', #{agriCitySampleTestDetails.samplingLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.detectLocation != null and agriCitySampleTestDetails.detectLocation != ''">
                AND detect_location LIKE concat('%', #{agriCitySampleTestDetails.detectLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingStageType != null and agriCitySampleTestDetails.samplingStageType != ''">
                AND sampling_stage_type LIKE concat('%', #{agriCitySampleTestDetails.samplingStageType}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingDate != null">
                AND sampling_date = #{agriCitySampleTestDetails.samplingDate}
            </if>
            <if test="agriCitySampleTestDetails.chinaStandard != null and agriCitySampleTestDetails.chinaStandard != ''">
                AND china_standard = #{agriCitySampleTestDetails.chinaStandard}
            </if>
            <if test="agriCitySampleTestDetails.cacStandard != null and agriCitySampleTestDetails.cacStandard != ''">
                AND cac_standard = #{agriCitySampleTestDetails.cacStandard}
            </if>
            <if test="agriCitySampleTestDetails.japanStandard != null and agriCitySampleTestDetails.japanStandard != ''">
                AND japan_standard = #{agriCitySampleTestDetails.japanStandard}
            </if>
            <if test="agriCitySampleTestDetails.euStandard != null and agriCitySampleTestDetails.euStandard != ''">
                AND eu_standard = #{agriCitySampleTestDetails.euStandard}
            </if>
            <if test="agriCitySampleTestDetails.usStandard != null and agriCitySampleTestDetails.usStandard != ''">
                AND us_standard = #{agriCitySampleTestDetails.usStandard}
            </if>
            <if test="agriCitySampleTestDetails.koreaStandard != null and agriCitySampleTestDetails.koreaStandard != ''">
                AND korea_standard = #{agriCitySampleTestDetails.koreaStandard}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationProvince != null and agriCitySampleTestDetails.samplingLocationProvince != ''">
                AND sampling_location_province = #{agriCitySampleTestDetails.samplingLocationProvince}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCity != null and agriCitySampleTestDetails.samplingLocationCity != ''">
                AND sampling_location_city = #{agriCitySampleTestDetails.samplingLocationCity}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCounty != null and agriCitySampleTestDetails.samplingLocationCounty != ''">
                AND sampling_location_county = #{agriCitySampleTestDetails.samplingLocationCounty}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseAttribute != null and agriCitySampleTestDetails.enterpriseAttribute != ''">
                AND enterprise_attribute = #{agriCitySampleTestDetails.enterpriseAttribute}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseName != null and agriCitySampleTestDetails.enterpriseName != ''">
                AND enterprise_name = #{agriCitySampleTestDetails.enterpriseName}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseCreditIdCode != null and agriCitySampleTestDetails.enterpriseCreditIdCode != ''">
                AND enterprise_credit_id_code = #{agriCitySampleTestDetails.enterpriseCreditIdCode}
            </if>
            <if test="agriCitySampleTestDetails.tracingProvince != null and agriCitySampleTestDetails.tracingProvince != ''">
                AND tracing_province = #{agriCitySampleTestDetails.tracingProvince}
            </if>
            <if test="agriCitySampleTestDetails.tracingCity != null and agriCitySampleTestDetails.tracingCity != ''">
                AND tracing_city = #{agriCitySampleTestDetails.tracingCity}
            </if>
            <if test="agriCitySampleTestDetails.tracingCounty != null and agriCitySampleTestDetails.tracingCounty != ''">
                AND tracing_county = #{agriCitySampleTestDetails.tracingCounty}
            </if>
            <if test="agriCitySampleTestDetails.tracingArea != null and agriCitySampleTestDetails.tracingArea != ''">
                AND tracing_area = #{agriCitySampleTestDetails.tracingArea}
            </if>
            <if test="agriCitySampleTestDetails.userName != null and agriCitySampleTestDetails.userName != ''">
                AND user_name = #{agriCitySampleTestDetails.userName}
            </if>
            <if test="agriCitySampleTestDetails.params.beginTime != null and agriCitySampleTestDetails.params.beginTime != ''"><!-- 开始时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &gt;= date_format(#{agriCitySampleTestDetails.params.beginTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.params.endTime != null and agriCitySampleTestDetails.params.endTime != ''"><!-- 结束时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &lt;= date_format(#{agriCitySampleTestDetails.params.endTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.samplingType != null and agriCitySampleTestDetails.samplingType != ''">
                AND sampling_type = #{agriCitySampleTestDetails.samplingType}
            </if>




        </where>
        GROUP BY COALESCE(IF(TRIM(af.`detail_type`) = '', '水果其它类', af.`detail_type`), '水果其它类')
        ORDER BY `sample_count` DESC
    </select>









    <select id="selectTeaDetailTypeInventory" resultType="OutDetailTypeInventoryVo">
        SELECT
        COALESCE(IF(TRIM(af.`detail_type`) = '', '茶叶其它类', af.`detail_type`), '茶叶其它类') AS `detail_type`,
        COUNT(acstd.`city_sample_test_details_id`) AS `sample_count`
        FROM `agri_city_sample_test_details` acstd
        JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`
        <where>
            <if test="vegFruType != null and vegFruType != ''">
                af.`veg_fru_type` = #{vegFruType}
            </if>

            <if test="agriCitySampleTestDetails.sampleCode != null and agriCitySampleTestDetails.sampleCode != ''">
                AND sample_code = #{agriCitySampleTestDetails.sampleCode}
            </if>
            <if test="agriCitySampleTestDetails.vegFruName != null and agriCitySampleTestDetails.vegFruName != ''">
                AND veg_fru_name LIKE concat('%', #{agriCitySampleTestDetails.vegFruName}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingLocation != null and agriCitySampleTestDetails.samplingLocation != ''">
                AND sampling_location LIKE concat('%', #{agriCitySampleTestDetails.samplingLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.detectLocation != null and agriCitySampleTestDetails.detectLocation != ''">
                AND detect_location LIKE concat('%', #{agriCitySampleTestDetails.detectLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingStageType != null and agriCitySampleTestDetails.samplingStageType != ''">
                AND sampling_stage_type LIKE concat('%', #{agriCitySampleTestDetails.samplingStageType}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingDate != null">
                AND sampling_date = #{agriCitySampleTestDetails.samplingDate}
            </if>
            <if test="agriCitySampleTestDetails.chinaStandard != null and agriCitySampleTestDetails.chinaStandard != ''">
                AND china_standard = #{agriCitySampleTestDetails.chinaStandard}
            </if>
            <if test="agriCitySampleTestDetails.cacStandard != null and agriCitySampleTestDetails.cacStandard != ''">
                AND cac_standard = #{agriCitySampleTestDetails.cacStandard}
            </if>
            <if test="agriCitySampleTestDetails.japanStandard != null and agriCitySampleTestDetails.japanStandard != ''">
                AND japan_standard = #{agriCitySampleTestDetails.japanStandard}
            </if>
            <if test="agriCitySampleTestDetails.euStandard != null and agriCitySampleTestDetails.euStandard != ''">
                AND eu_standard = #{agriCitySampleTestDetails.euStandard}
            </if>
            <if test="agriCitySampleTestDetails.usStandard != null and agriCitySampleTestDetails.usStandard != ''">
                AND us_standard = #{agriCitySampleTestDetails.usStandard}
            </if>
            <if test="agriCitySampleTestDetails.koreaStandard != null and agriCitySampleTestDetails.koreaStandard != ''">
                AND korea_standard = #{agriCitySampleTestDetails.koreaStandard}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationProvince != null and agriCitySampleTestDetails.samplingLocationProvince != ''">
                AND sampling_location_province = #{agriCitySampleTestDetails.samplingLocationProvince}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCity != null and agriCitySampleTestDetails.samplingLocationCity != ''">
                AND sampling_location_city = #{agriCitySampleTestDetails.samplingLocationCity}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCounty != null and agriCitySampleTestDetails.samplingLocationCounty != ''">
                AND sampling_location_county = #{agriCitySampleTestDetails.samplingLocationCounty}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseAttribute != null and agriCitySampleTestDetails.enterpriseAttribute != ''">
                AND enterprise_attribute = #{agriCitySampleTestDetails.enterpriseAttribute}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseName != null and agriCitySampleTestDetails.enterpriseName != ''">
                AND enterprise_name = #{agriCitySampleTestDetails.enterpriseName}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseCreditIdCode != null and agriCitySampleTestDetails.enterpriseCreditIdCode != ''">
                AND enterprise_credit_id_code = #{agriCitySampleTestDetails.enterpriseCreditIdCode}
            </if>
            <if test="agriCitySampleTestDetails.tracingProvince != null and agriCitySampleTestDetails.tracingProvince != ''">
                AND tracing_province = #{agriCitySampleTestDetails.tracingProvince}
            </if>
            <if test="agriCitySampleTestDetails.tracingCity != null and agriCitySampleTestDetails.tracingCity != ''">
                AND tracing_city = #{agriCitySampleTestDetails.tracingCity}
            </if>
            <if test="agriCitySampleTestDetails.tracingCounty != null and agriCitySampleTestDetails.tracingCounty != ''">
                AND tracing_county = #{agriCitySampleTestDetails.tracingCounty}
            </if>
            <if test="agriCitySampleTestDetails.tracingArea != null and agriCitySampleTestDetails.tracingArea != ''">
                AND tracing_area = #{agriCitySampleTestDetails.tracingArea}
            </if>
            <if test="agriCitySampleTestDetails.userName != null and agriCitySampleTestDetails.userName != ''">
                AND user_name = #{agriCitySampleTestDetails.userName}
            </if>
            <if test="agriCitySampleTestDetails.params.beginTime != null and agriCitySampleTestDetails.params.beginTime != ''"><!-- 开始时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &gt;= date_format(#{agriCitySampleTestDetails.params.beginTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.params.endTime != null and agriCitySampleTestDetails.params.endTime != ''"><!-- 结束时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &lt;= date_format(#{agriCitySampleTestDetails.params.endTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.samplingType != null and agriCitySampleTestDetails.samplingType != ''">
                AND sampling_type = #{agriCitySampleTestDetails.samplingType}
            </if>




        </where>
        GROUP BY COALESCE(IF(TRIM(af.`detail_type`) = '', '茶叶其它类', af.`detail_type`), '茶叶其它类')
        ORDER BY `sample_count` DESC
    </select>



































<!--   不包含其它类的情况，因为显示不出为空的其它类的数量-->
<!--    <select id="selectVegFruNameInventoryByDetailType"  resultType="OutVegFruNameInventoryVo">-->
<!--        SELECT-->
<!--            af.`veg_fru_name`,-->
<!--            COUNT(*) AS `sample_detail_count`-->
<!--        FROM `agri_city_sample_test_details` acstd-->
<!--                 JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`-->
<!--        WHERE af.`detail_type` = #{detailType}-->
<!--        GROUP BY af.`veg_fru_name`-->
<!--        ORDER BY `sample_detail_count` DESC;-->

<!--    </select>-->




    <!--   只能查询其它类的情况，如果查询别的类，例如柑橘类，会把空的其它类也计算进去-->
<!--    <select id="selectVegFruNameOtherTypeInventoryByDetailType"  resultType="OutVegFruNameInventoryVo">-->
<!--        SELECT-->
<!--            af.`veg_fru_name`,-->
<!--            COUNT(*) AS `sample_detail_count`-->
<!--        FROM `agri_city_sample_test_details` acstd-->
<!--                 JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`-->
<!--        WHERE (af.`detail_type` = #{detailType} OR af.`detail_type` IS NULL OR TRIM(af.`detail_type`) = '')-->
<!--          AND af.`veg_fru_type` = #{vegFruType}-->
<!--        GROUP BY af.`veg_fru_name`-->
<!--        ORDER BY `sample_detail_count` DESC-->
<!--    </select>-->


<!--用判断结合了上面2个的优点-->
    <select id="selectVegNameInventoryByDetailType"  resultType="OutVegFruNameInventoryVo">
        SELECT
            af.`veg_fru_name`,
            COUNT(*) AS `sample_detail_count`
        FROM `agri_city_sample_test_details` acstd
                 JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`
        <where>
            <if test="detailType != null and detailType == '蔬菜其它类'">
            (af.`detail_type` = #{detailType} OR af.`detail_type` IS NULL OR TRIM(af.`detail_type`) = '')
            </if>
            <if test="detailType != null and detailType != '蔬菜其它类'">
                AND (af.`detail_type` = #{detailType} )
            </if>




            <if test="vegFruType != null and vegFruType != ''">
                AND af.`veg_fru_type` = #{vegFruType}
            </if>

            <if test="agriCitySampleTestDetails.sampleCode != null and agriCitySampleTestDetails.sampleCode != ''">
                AND sample_code = #{agriCitySampleTestDetails.sampleCode}
            </if>
            <if test="agriCitySampleTestDetails.vegFruName != null and agriCitySampleTestDetails.vegFruName != ''">
                AND af.veg_fru_name LIKE concat('%', #{agriCitySampleTestDetails.vegFruName}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingLocation != null and agriCitySampleTestDetails.samplingLocation != ''">
                AND sampling_location LIKE concat('%', #{agriCitySampleTestDetails.samplingLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.detectLocation != null and agriCitySampleTestDetails.detectLocation != ''">
                AND detect_location LIKE concat('%', #{agriCitySampleTestDetails.detectLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingStageType != null and agriCitySampleTestDetails.samplingStageType != ''">
                AND sampling_stage_type LIKE concat('%', #{agriCitySampleTestDetails.samplingStageType}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingDate != null">
                AND sampling_date = #{agriCitySampleTestDetails.samplingDate}
            </if>
            <if test="agriCitySampleTestDetails.chinaStandard != null and agriCitySampleTestDetails.chinaStandard != ''">
                AND china_standard = #{agriCitySampleTestDetails.chinaStandard}
            </if>
            <if test="agriCitySampleTestDetails.cacStandard != null and agriCitySampleTestDetails.cacStandard != ''">
                AND cac_standard = #{agriCitySampleTestDetails.cacStandard}
            </if>
            <if test="agriCitySampleTestDetails.japanStandard != null and agriCitySampleTestDetails.japanStandard != ''">
                AND japan_standard = #{agriCitySampleTestDetails.japanStandard}
            </if>
            <if test="agriCitySampleTestDetails.euStandard != null and agriCitySampleTestDetails.euStandard != ''">
                AND eu_standard = #{agriCitySampleTestDetails.euStandard}
            </if>
            <if test="agriCitySampleTestDetails.usStandard != null and agriCitySampleTestDetails.usStandard != ''">
                AND us_standard = #{agriCitySampleTestDetails.usStandard}
            </if>
            <if test="agriCitySampleTestDetails.koreaStandard != null and agriCitySampleTestDetails.koreaStandard != ''">
                AND korea_standard = #{agriCitySampleTestDetails.koreaStandard}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationProvince != null and agriCitySampleTestDetails.samplingLocationProvince != ''">
                AND sampling_location_province = #{agriCitySampleTestDetails.samplingLocationProvince}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCity != null and agriCitySampleTestDetails.samplingLocationCity != ''">
                AND sampling_location_city = #{agriCitySampleTestDetails.samplingLocationCity}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCounty != null and agriCitySampleTestDetails.samplingLocationCounty != ''">
                AND sampling_location_county = #{agriCitySampleTestDetails.samplingLocationCounty}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseAttribute != null and agriCitySampleTestDetails.enterpriseAttribute != ''">
                AND enterprise_attribute = #{agriCitySampleTestDetails.enterpriseAttribute}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseName != null and agriCitySampleTestDetails.enterpriseName != ''">
                AND enterprise_name = #{agriCitySampleTestDetails.enterpriseName}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseCreditIdCode != null and agriCitySampleTestDetails.enterpriseCreditIdCode != ''">
                AND enterprise_credit_id_code = #{agriCitySampleTestDetails.enterpriseCreditIdCode}
            </if>
            <if test="agriCitySampleTestDetails.tracingProvince != null and agriCitySampleTestDetails.tracingProvince != ''">
                AND tracing_province = #{agriCitySampleTestDetails.tracingProvince}
            </if>
            <if test="agriCitySampleTestDetails.tracingCity != null and agriCitySampleTestDetails.tracingCity != ''">
                AND tracing_city = #{agriCitySampleTestDetails.tracingCity}
            </if>
            <if test="agriCitySampleTestDetails.tracingCounty != null and agriCitySampleTestDetails.tracingCounty != ''">
                AND tracing_county = #{agriCitySampleTestDetails.tracingCounty}
            </if>
            <if test="agriCitySampleTestDetails.tracingArea != null and agriCitySampleTestDetails.tracingArea != ''">
                AND tracing_area = #{agriCitySampleTestDetails.tracingArea}
            </if>
            <if test="agriCitySampleTestDetails.params.beginTime != null and agriCitySampleTestDetails.params.beginTime != ''"><!-- 开始时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &gt;= date_format(#{agriCitySampleTestDetails.params.beginTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.params.endTime != null and agriCitySampleTestDetails.params.endTime != ''"><!-- 结束时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &lt;= date_format(#{agriCitySampleTestDetails.params.endTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.samplingType != null and agriCitySampleTestDetails.samplingType != ''">
                AND sampling_type = #{agriCitySampleTestDetails.samplingType}
            </if>


        </where>

        GROUP BY af.`veg_fru_name`
        ORDER BY `sample_detail_count` DESC
    </select>



    <select id="selectFruNameInventoryByDetailType"  resultType="OutVegFruNameInventoryVo">
        SELECT
        af.`veg_fru_name`,
        COUNT(*) AS `sample_detail_count`
        FROM `agri_city_sample_test_details` acstd
        JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`
        <where>
            <if test="detailType != null and detailType == '水果其它类'">
                (af.`detail_type` = #{detailType} OR af.`detail_type` IS NULL OR TRIM(af.`detail_type`) = '')
            </if>
            <if test="detailType != null and detailType != '水果其它类'">
                AND (af.`detail_type` = #{detailType} )
            </if>

            <if test="vegFruType != null and vegFruType != ''">
                AND af.`veg_fru_type` = #{vegFruType}
            </if>

            <if test="agriCitySampleTestDetails.sampleCode != null and agriCitySampleTestDetails.sampleCode != ''">
                AND sample_code = #{agriCitySampleTestDetails.sampleCode}
            </if>
            <if test="agriCitySampleTestDetails.vegFruName != null and agriCitySampleTestDetails.vegFruName != ''">
                AND af.veg_fru_name LIKE concat('%', #{agriCitySampleTestDetails.vegFruName}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingLocation != null and agriCitySampleTestDetails.samplingLocation != ''">
                AND sampling_location LIKE concat('%', #{agriCitySampleTestDetails.samplingLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.detectLocation != null and agriCitySampleTestDetails.detectLocation != ''">
                AND detect_location LIKE concat('%', #{agriCitySampleTestDetails.detectLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingStageType != null and agriCitySampleTestDetails.samplingStageType != ''">
                AND sampling_stage_type LIKE concat('%', #{agriCitySampleTestDetails.samplingStageType}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingDate != null">
                AND sampling_date = #{agriCitySampleTestDetails.samplingDate}
            </if>
            <if test="agriCitySampleTestDetails.chinaStandard != null and agriCitySampleTestDetails.chinaStandard != ''">
                AND china_standard = #{agriCitySampleTestDetails.chinaStandard}
            </if>
            <if test="agriCitySampleTestDetails.cacStandard != null and agriCitySampleTestDetails.cacStandard != ''">
                AND cac_standard = #{agriCitySampleTestDetails.cacStandard}
            </if>
            <if test="agriCitySampleTestDetails.japanStandard != null and agriCitySampleTestDetails.japanStandard != ''">
                AND japan_standard = #{agriCitySampleTestDetails.japanStandard}
            </if>
            <if test="agriCitySampleTestDetails.euStandard != null and agriCitySampleTestDetails.euStandard != ''">
                AND eu_standard = #{agriCitySampleTestDetails.euStandard}
            </if>
            <if test="agriCitySampleTestDetails.usStandard != null and agriCitySampleTestDetails.usStandard != ''">
                AND us_standard = #{agriCitySampleTestDetails.usStandard}
            </if>
            <if test="agriCitySampleTestDetails.koreaStandard != null and agriCitySampleTestDetails.koreaStandard != ''">
                AND korea_standard = #{agriCitySampleTestDetails.koreaStandard}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationProvince != null and agriCitySampleTestDetails.samplingLocationProvince != ''">
                AND sampling_location_province = #{agriCitySampleTestDetails.samplingLocationProvince}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCity != null and agriCitySampleTestDetails.samplingLocationCity != ''">
                AND sampling_location_city = #{agriCitySampleTestDetails.samplingLocationCity}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCounty != null and agriCitySampleTestDetails.samplingLocationCounty != ''">
                AND sampling_location_county = #{agriCitySampleTestDetails.samplingLocationCounty}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseAttribute != null and agriCitySampleTestDetails.enterpriseAttribute != ''">
                AND enterprise_attribute = #{agriCitySampleTestDetails.enterpriseAttribute}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseName != null and agriCitySampleTestDetails.enterpriseName != ''">
                AND enterprise_name = #{agriCitySampleTestDetails.enterpriseName}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseCreditIdCode != null and agriCitySampleTestDetails.enterpriseCreditIdCode != ''">
                AND enterprise_credit_id_code = #{agriCitySampleTestDetails.enterpriseCreditIdCode}
            </if>
            <if test="agriCitySampleTestDetails.tracingProvince != null and agriCitySampleTestDetails.tracingProvince != ''">
                AND tracing_province = #{agriCitySampleTestDetails.tracingProvince}
            </if>
            <if test="agriCitySampleTestDetails.tracingCity != null and agriCitySampleTestDetails.tracingCity != ''">
                AND tracing_city = #{agriCitySampleTestDetails.tracingCity}
            </if>
            <if test="agriCitySampleTestDetails.tracingCounty != null and agriCitySampleTestDetails.tracingCounty != ''">
                AND tracing_county = #{agriCitySampleTestDetails.tracingCounty}
            </if>
            <if test="agriCitySampleTestDetails.tracingArea != null and agriCitySampleTestDetails.tracingArea != ''">
                AND tracing_area = #{agriCitySampleTestDetails.tracingArea}
            </if>
            <if test="agriCitySampleTestDetails.params.beginTime != null and agriCitySampleTestDetails.params.beginTime != ''"><!-- 开始时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &gt;= date_format(#{agriCitySampleTestDetails.params.beginTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.params.endTime != null and agriCitySampleTestDetails.params.endTime != ''"><!-- 结束时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &lt;= date_format(#{agriCitySampleTestDetails.params.endTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.samplingType != null and agriCitySampleTestDetails.samplingType != ''">
                AND sampling_type = #{agriCitySampleTestDetails.samplingType}
            </if>




        </where>

        GROUP BY af.`veg_fru_name`
        ORDER BY `sample_detail_count` DESC
    </select>



    <select id="selectTeaNameInventoryByDetailType"  resultType="OutVegFruNameInventoryVo">
        SELECT
        af.`veg_fru_name`,
        COUNT(*) AS `sample_detail_count`
        FROM `agri_city_sample_test_details` acstd
        JOIN `agri_vegetable_fruit` af ON acstd.`veg_fru_name` = af.`veg_fru_name`
        <where>
            <if test="detailType != null and detailType == '茶叶其它类'">
                (af.`detail_type` = #{detailType} OR af.`detail_type` IS NULL OR TRIM(af.`detail_type`) = '')
            </if>
            <if test="detailType != null and detailType != '茶叶其它类'">
                AND (af.`detail_type` = #{detailType} )
            </if>


            <if test="vegFruType != null and vegFruType != ''">
               AND  af.`veg_fru_type` = #{vegFruType}
            </if>

            <if test="agriCitySampleTestDetails.sampleCode != null and agriCitySampleTestDetails.sampleCode != ''">
                AND sample_code = #{agriCitySampleTestDetails.sampleCode}
            </if>
            <if test="agriCitySampleTestDetails.vegFruName != null and agriCitySampleTestDetails.vegFruName != ''">
                AND af.veg_fru_name LIKE concat('%', #{agriCitySampleTestDetails.vegFruName}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingLocation != null and agriCitySampleTestDetails.samplingLocation != ''">
                AND sampling_location LIKE concat('%', #{agriCitySampleTestDetails.samplingLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.detectLocation != null and agriCitySampleTestDetails.detectLocation != ''">
                AND detect_location LIKE concat('%', #{agriCitySampleTestDetails.detectLocation}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingStageType != null and agriCitySampleTestDetails.samplingStageType != ''">
                AND sampling_stage_type LIKE concat('%', #{agriCitySampleTestDetails.samplingStageType}, '%')
            </if>
            <if test="agriCitySampleTestDetails.samplingDate != null">
                AND sampling_date = #{agriCitySampleTestDetails.samplingDate}
            </if>
            <if test="agriCitySampleTestDetails.chinaStandard != null and agriCitySampleTestDetails.chinaStandard != ''">
                AND china_standard = #{agriCitySampleTestDetails.chinaStandard}
            </if>
            <if test="agriCitySampleTestDetails.cacStandard != null and agriCitySampleTestDetails.cacStandard != ''">
                AND cac_standard = #{agriCitySampleTestDetails.cacStandard}
            </if>
            <if test="agriCitySampleTestDetails.japanStandard != null and agriCitySampleTestDetails.japanStandard != ''">
                AND japan_standard = #{agriCitySampleTestDetails.japanStandard}
            </if>
            <if test="agriCitySampleTestDetails.euStandard != null and agriCitySampleTestDetails.euStandard != ''">
                AND eu_standard = #{agriCitySampleTestDetails.euStandard}
            </if>
            <if test="agriCitySampleTestDetails.usStandard != null and agriCitySampleTestDetails.usStandard != ''">
                AND us_standard = #{agriCitySampleTestDetails.usStandard}
            </if>
            <if test="agriCitySampleTestDetails.koreaStandard != null and agriCitySampleTestDetails.koreaStandard != ''">
                AND korea_standard = #{agriCitySampleTestDetails.koreaStandard}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationProvince != null and agriCitySampleTestDetails.samplingLocationProvince != ''">
                AND sampling_location_province = #{agriCitySampleTestDetails.samplingLocationProvince}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCity != null and agriCitySampleTestDetails.samplingLocationCity != ''">
                AND sampling_location_city = #{agriCitySampleTestDetails.samplingLocationCity}
            </if>
            <if test="agriCitySampleTestDetails.samplingLocationCounty != null and agriCitySampleTestDetails.samplingLocationCounty != ''">
                AND sampling_location_county = #{agriCitySampleTestDetails.samplingLocationCounty}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseAttribute != null and agriCitySampleTestDetails.enterpriseAttribute != ''">
                AND enterprise_attribute = #{agriCitySampleTestDetails.enterpriseAttribute}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseName != null and agriCitySampleTestDetails.enterpriseName != ''">
                AND enterprise_name = #{agriCitySampleTestDetails.enterpriseName}
            </if>
            <if test="agriCitySampleTestDetails.enterpriseCreditIdCode != null and agriCitySampleTestDetails.enterpriseCreditIdCode != ''">
                AND enterprise_credit_id_code = #{agriCitySampleTestDetails.enterpriseCreditIdCode}
            </if>
            <if test="agriCitySampleTestDetails.tracingProvince != null and agriCitySampleTestDetails.tracingProvince != ''">
                AND tracing_province = #{agriCitySampleTestDetails.tracingProvince}
            </if>
            <if test="agriCitySampleTestDetails.tracingCity != null and agriCitySampleTestDetails.tracingCity != ''">
                AND tracing_city = #{agriCitySampleTestDetails.tracingCity}
            </if>
            <if test="agriCitySampleTestDetails.tracingCounty != null and agriCitySampleTestDetails.tracingCounty != ''">
                AND tracing_county = #{agriCitySampleTestDetails.tracingCounty}
            </if>
            <if test="agriCitySampleTestDetails.tracingArea != null and agriCitySampleTestDetails.tracingArea != ''">
                AND tracing_area = #{agriCitySampleTestDetails.tracingArea}
            </if>
            <if test="agriCitySampleTestDetails.params.beginTime != null and agriCitySampleTestDetails.params.beginTime != ''"><!-- 开始时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &gt;= date_format(#{agriCitySampleTestDetails.params.beginTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.params.endTime != null and agriCitySampleTestDetails.params.endTime != ''"><!-- 结束时间检索 -->
                AND date_format(sampling_date,'%y%m%d') &lt;= date_format(#{agriCitySampleTestDetails.params.endTime},'%y%m%d')
            </if>
            <if test="agriCitySampleTestDetails.samplingType != null and agriCitySampleTestDetails.samplingType != ''">
                AND sampling_type = #{agriCitySampleTestDetails.samplingType}
            </if>


        </where>

        GROUP BY af.`veg_fru_name`
        ORDER BY `sample_detail_count` DESC
    </select>





</mapper>